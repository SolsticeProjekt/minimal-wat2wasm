
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>blablabla</title>
        <script src="libwabt.js"></script>
    </head>
<body>
<script>


var Features = {  "exceptions": false,
                  "mutable_globals": true,
                  "sat_float_to_int":false,
                  "sign_extension":false,
                  "simd":false,
                  "threads":false,
                  "multi_value":false,
                  "tail_call":false     }

var module = WabtModule().parseWat('test.wast',

`
(module
(func $addTwo (param i32 i32) (result i32)
    get_local 0
    get_local 1
    i32.add)
(export "addTwo" (func $addTwo)))
`, Features);

    module.resolveNames();
    module.validate(Features);
    var binaryOutput = module.toBinary({log: true, write_debug_names:true});
    binaryBuffer = binaryOutput.buffer;

    let wasm = new WebAssembly.Module(binaryBuffer);
    js = `const wasmInstance = new WebAssembly.Instance(wasmModule, {});
        const { addTwo } = wasmInstance.exports;`
    
    const wasmInstance = new WebAssembly.Instance(wasm, {});
    const { addTwo } = wasmInstance.exports;
    // let fn = new Function('wasmModule', 'console', js + '//# sourceURL=demo.js');
    // fn(wasm)
    // const wasmInstance =    new WebAssembly.Instance(wasmModule, {});
    // const { addTwo } = wasmInstance.exports;
    document.body.innerText = addTwo(1,3)

</script>
</body>
</html>
